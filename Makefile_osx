COMPILER=gcc

SOURCES = math_acosf.c math_asinf.c math_atan2f.c math_atanf.c math_ceilf.c \
          math_cosf.c math_coshf.c math_expf.c math_fabsf.c math_floorf.c math_fmodf.c \
          math_frexpf.c math_invsqrtf.c math_ldexpf.c math_log10f.c math_logf.c \
          math_mat2.c math_mat3.c math_mat4.c math_modf.c math_powf.c math_runfast.c \
          math_sincosf.c math_sinf.c math_sinfv.c math_sinhf.c math_sqrtf.c math_sqrtfv.c \
          math_tanf.c math_tanhf.c math_vec2.c math_vec3.c math_vec4.c

OBJS    = math_acosf.o math_asinf.o math_atan2f.o math_atanf.o math_ceilf.o \
          math_cosf.o math_coshf.o math_expf.o math_fabsf.o math_floorf.o math_fmodf.o \
          math_frexpf.o math_invsqrtf.o math_ldexpf.o math_log10f.o math_logf.o \
          math_mat2.o math_mat3.o math_mat4.o math_modf.o math_powf.o math_runfast.o \
          math_sincosf.o math_sinf.o math_sinfv.o math_sinhf.o math_sqrtf.o math_sqrtfv.o \
          math_tanf.o math_tanhf.o math_vec2.o math_vec3.o math_vec4.o 
          
HEADERS = mathneon.h

target arm : FLAGS = -mfpu=neon -mfloat-abi=softfp -mcpu=cortex-a8 -ftree-vectorize -fsingle-precision-constant -fomit-frame-pointer -O3 -ffast-math
target test : FLAGS = -mfpu=neon -mfloat-abi=hard -mcpu=cortex-a8 -ftree-vectorize -fsingle-precision-constant -fomit-frame-pointer -O3 -ffast-math
target x86 : FLAGS = -fsingle-precision-constant -fomit-frame-pointer -O3 -ffast-math
target debug : FLAGS = -g

arm : mathneon_so mathneon_a clean
x86 : mathneon_so mathneon_a clean
debug : mathneon_so mathneon_a clean
test : mathneon_test

so_arm : mathneon_so
so_x86 : mathneon_so
so_debug : mathneon_so

a_arm : mathneon_a
a_x86 : mathneon_a
a_debug : mathneon_a


install:
	rm -f /usr/local/lib/libmathneon.*
	rm -f /usr/local/include/mathneon.h
	cp libmathneon.a /usr/local/lib/
#	cp libmathneon.so.1.0.0 /usr/local/lib/
	cp libmathneon.h /usr/local/include/mathneon.h

mathneon_test: mathneon_a.o mathneon_test.o
	$(COMPILER) $(FLAGS) -o mathtest mathneon_debug.o $(OBJS) -lm

mathneon_a: mathneon_a.o
	ar rcs libmathneon.a $(OBJS)

mathneon_so: mathneon_so.o
	rm -f libmathneon.so*
	$(COMPILER) -shared -Wl,-install_name,libmathneon.so.1 -o libmathneon.so.1.0.0 $(OBJS) -lm
	
mathneon_so.o: $(SOURCES) $(HEADERS)
	$(COMPILER) $(FLAGS) -fPIC -c $(SOURCES) $(HEADERS) 

mathneon_a.o: $(SOURCES) $(HEADERS)
	$(COMPILER) $(FLAGS) -c $(SOURCES) $(HEADERS) -lm
	
mathneon_test.o: mathneon_debug.c $(HEADERS)
	$(COMPILER) $(FLAGS) -c mathneon_debug.c $(HEADERS) -lm

clean:
	rm -f *.o
	rm -f *.gch

